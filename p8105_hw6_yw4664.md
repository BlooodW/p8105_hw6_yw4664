p8105_hw6_yw4664
================
Yijun Wang
2025-11-27

## Problem 1

### Loading Libraries

``` r
library(tidyverse)

library(broom)

library(purrr)
```

### 1. Data Reading & Cleaning

``` r
homicide_df = read_csv("data/homicide-data.csv") |>
  mutate(
    city_state = str_c(city, state, sep = ", "),
    solved = case_when(
      disposition == "Closed by arrest" ~ 1,
      TRUE ~ 0
    ),
    victim_age = as.numeric(victim_age)
  ) |>
  
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) |>
  
  filter(victim_race %in% c("White", "Black"))
```

### 2. Logistic model for Baltimore

``` r
baltimore_df =
  homicide_df |>
  filter(city_state == "Baltimore, MD")

baltimore_fit =
  glm(
    solved ~ victim_age + victim_sex + victim_race,
    data = baltimore_df,
    family = binomial()
  )

# tidy version with OR + CI
baltimore_or =
  baltimore_fit |>
  tidy(conf.int = TRUE, exponentiate = TRUE)

# Odds Ratio
baltimore_or |> filter(term == "victim_sexMale")
```

    ## # A tibble: 1 Ã— 7
    ##   term           estimate std.error statistic  p.value conf.low conf.high
    ##   <chr>             <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>
    ## 1 victim_sexMale    0.426     0.138     -6.18 6.26e-10    0.324     0.558

### 3. Logistic models for each city

``` r
models_df =
  homicide_df |>
  nest(data = -city_state) |>
  mutate(
    fit = map(
      data,
      ~ glm(
        solved ~ victim_age + victim_sex + victim_race,
        data = .x,
        family = binomial()
      )
    ),
    results = purrr::map(
      fit,
      ~ tidy(.x, conf.int = TRUE, exponentiate = TRUE)
    )
  ) |>
  select(city_state, results) |>
  unnest(results) |>
  filter(term == "victim_sexMale") |>
  rename(
    or = estimate,
    ci_low = conf.low,
    ci_high = conf.high
  )
```

### 4. Plot estimated ORs and CIs for each city

``` r
models_df |>
  mutate(city_state = fct_reorder(city_state, or)) |>
  ggplot(aes(x = city_state, y = or)) +
  geom_point() +
  geom_errorbar(aes(ymin = ci_low, ymax = ci_high), width = 0.2) +
  coord_flip() +
  labs(
    title = "Adjusted Odds Ratio",
    x = "City",
    y = "Adjusted OR"
  ) +
  theme_minimal(base_size = 12)
```

<img src="p8105_hw6_yw4664_files/figure-gfm/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;" />

Across cities, the adjusted odds ratios comparing male to female victims
show considerable variability. Most cities have ORs close to 1,
indicating only modest differences in clearance rates after adjusting
for age and race.

A small number of cities exhibit notably higher or lower ORs, but many
of these estimates have wide confidence intervals, suggesting limited
data and substantial uncertainty. Cities do not follow a consistent
geographic pattern.

## Problem 2

### Loading Libraries and Data

``` r
library(tidyverse)
library(p8105.datasets)
library(broom)
library(modelr)
```

    ## 
    ## Attaching package: 'modelr'

    ## The following object is masked from 'package:broom':
    ## 
    ##     bootstrap

``` r
data("weather_df")

weather_clean =
  weather_df |>
  drop_na(tmax, tmin, prcp) |>
  select(tmax, tmin, prcp)
```
